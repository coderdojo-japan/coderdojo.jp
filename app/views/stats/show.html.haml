- provide(:title, 'çµ±è¨ˆæƒ…å ±')
- provide(:desc,  'CoderDojo ã®çµ±è¨ˆæƒ…å ±ã‚’ã¾ã¨ã‚ãŸãƒšãƒ¼ã‚¸ã§ã™ã€‚å…¨å›½ã®æ´»å‹•çŠ¶æ³ã‚’æŠŠæ¡ã—ãŸã„å ´é¢ãªã©ã§ã”æ´»ç”¨ãã ã•ã„ã€‚')
- provide(:url,   stats_url)
- provide(:meta_image,  "/img/ogp-stats.jpeg")

%script{ type: 'text/javascript', src: '/js/jquery.japan-map.js'}

%section#top{style: 'padding-top:40px; background-color: white; max-width: 400px; margin: 0 auto;'}
  = lazy_image_tag 'stats_cover.png', alt: 'Cover photo for CoderDojo Stats'

%section.stats.text-center
  %h1 çµ±è¨ˆæƒ…å ±
  %div{style: "margin: 30px 36px 0;"}
    æœ¬ãƒšãƒ¼ã‚¸ã§ã¯ CoderDojo ã®çµ±è¨ˆæƒ…å ±ã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚
    %br.ignore-sp<>
    å…¨å›½ã®æ´»å‹•çŠ¶æ³ã‚’æŠŠæ¡ã—ãŸã„å ´é¢ãªã©ã§ã”æ´»ç”¨ãã ã•ã„ã€‚

  %h2#graph{style: "margin-top: 70px; color: #333333;"}
    %a{href: '#graph'}<
      ğŸ“Š
    æ¨ç§»ã‚°ãƒ©ãƒ•
  %div{align: 'center'}
    = high_chart_globals(@high_charts_globals)

    / é“å ´æ•°ã®æ¨ç§»
    %p{style: 'margin: 40px auto;'}
      = high_chart("annual_dojos",           @annual_dojos_chart)
      
    / é–‹å‚¬å›æ•°ã®æ¨ç§»
    %p{style: 'margin: 40px auto;'}
      = high_chart("annual_event_histories", @annual_event_histories_chart)

    / å‚åŠ è€…æ•°
    %p{style: 'margin: 40px auto;'}  
      = high_chart("annual_participants",    @annual_participants_chart)

  %h2#latest{style: "margin-top: 70px; color: #333333;"}
    %a{href: '#latest'}<
      ğŸ†•
    æœ€æ–°ãƒ‡ãƒ¼ã‚¿
  %p
    #{Time.current.year}å¹´ã®ãƒ‡ãƒ¼ã‚¿ã‚‚å«ã‚ãŸ
    %br<>
    æœ€æ–°ã®çµ±è¨ˆæƒ…å ±ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚
  %div{style: "margin-top: 20px;", align: 'center' }
    %table{style: 'margin-top: 4px;', border: '1'}
      %tr
        %th æ²è¼‰ä¸­ã®é“å ´æ•°
        %th ç´¯è¨ˆé–‹å‚¬å›æ•°
        %th ç´¯è¨ˆå‚åŠ è€…æ•°
      %tr.text-center
        %td= @sum_of_dojos
        %td= @sum_of_events
        %td= @sum_of_participants

  %div#tag{style: "margin-top: 20px;", align: 'center'}
    %br
    = high_chart("dojo_tag_chart", @dojo_tag_chart)

  %h2#table{style: "margin-top: 70px; color: #333333;"}
    %a{href: '#table'}<
      ğŸ“
    é›†è¨ˆæ–¹æ³•ã¨é›†è¨ˆå¯¾è±¡ã«ã¤ã„ã¦
  %ul{style: 'list-style: none; margin-left: -10px;'}
    %li å‚åŠ è€…æ•°ã¯ãƒ¦ãƒ‹ãƒ¼ã‚¯æ•°ã§ã¯ãªãå»¶ã¹æ•°ã§ã™ã€‚
    %li é›†è¨ˆå¯¾è±¡ã¯ API ãªã©ã§é›†è¨ˆå¯èƒ½ãªé“å ´ã§ã™ã€‚

  %p{style: 'margin-top: 10px;'}
    æ¯é€±æœˆæ›œæœ10æ™‚ã«é›†è¨ˆã‚’ã—ã¦ã„ã¾ã™ã€‚
    %br
    é›†è¨ˆå¯¾è±¡ã®é“å ´æ•°ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚
  %p{style: 'margin-top: 10px; margin-bottom: -5px;'}
    %b= @annual_dojos_table[@period_end.to_s]
    %b /
    %b= @annual_dojos_whole[@period_end.to_s]
    %b Dojos
  %span{style: 'font-size: 10px;'} ï¼ˆéã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã£ãŸé“å ´ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ï¼‰


  :css
    .table-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch; /* iOSã§ã®ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
      max-width: 99%; /* æ¨ªå¹…ã‚’ç”»é¢ã‚µã‚¤ã‚ºã«åˆã‚ã›ã‚‹ */
      margin: auto 5px;
    }

  %div#table-target{align: 'center', style: 'margin-top: 50px; scroll-margin-top: 80px;'}
    %b
      %a{href: '#table-target'} ğŸ”
      é›†è¨ˆå¯¾è±¡ã¨é›†è¨ˆå‰²åˆã®æ¨ç§»

  %div.table-container{align: 'center'}
    %table.compact{style: 'margin-top: 10px;', border: '1'}
      %tr
        %th
          %span.table-head è¥¿æš¦
        - @period_range.each do |year|
          %th
            %span.table-head &rsquo;#{year.to_s[2..]}
      %tr{style: 'text-align: center;'}
        %td
          %span.table-head é›†è¨ˆæ•°
        - @annual_dojos_table.each_value do |num|
          %td
            %span.table-item= num
      %tr{style: 'text-align: center;'}
        %td
          %span.table-head ç·é“å ´
        - @annual_dojos_whole.each_value do |num|
          %td
            %span.table-item= num
      %tr{style: 'text-align: center;'}
        %td
          %span.table-head å‰²åˆ
          %span.table-label<> [%]
        - @annual_dojos_ratio.each_value do |num|
          %td
            %span.table-item= num.eql?('100.0') ? '100' : num
    %span{style: 'font-size: 10px;'}
      â€»
      éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã£ãŸé“å ´ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™


  %div#table-actual{align: 'center', style: 'margin-top: 50px; scroll-margin-top: 80px;'}
    %b
      %a{href: '#table-actual'} â˜¯ï¸
      é–‹å‚¬å›æ•°ã¨å‚åŠ è€…æ•°ã®æ¨ç§»

  %div.table-container{align: 'center'}
    %table.compact{style: 'margin-top: 10px;', border: '1'}
      %tr
        %th
          %span.table-head<> è¥¿æš¦
        - @period_range.each do |year|
          %th
            %b
              %span.table-head &rsquo;#{year.to_s[2..]}
      %tr{style: 'text-align: center;'}
        %td
          %span.table-head<> å‰²åˆ
          %span.table-label<> [%]
        - @annual_dojos_ratio.each_value do |num|
          %td
            %span.table-item= num.eql?('100.0') ? '100' : num
      %tr{style: 'text-align: center;'}
        %td
          %span.table-head<> é–‹å‚¬
          %span.table-label<> (é›†è¨ˆ)
        - @annual_events_table.each_value.with_index(@period_start) do |num, year|
          %td
            %span.table-item= num
      %tr{style: 'text-align: center;'}
        %td
          %span.table-head<> å‚åŠ 
          %span.table-label<> (é›†è¨ˆ)
        - @annual_participants_table.each_value.with_index(@period_start) do |num, year|
          %td
            %span.table-item= num
    %span{style: 'font-size: 10px;'}
      â€»
      %a{href: '#graph'}<> å†’é ­ã®æ¨ç§»ã‚°ãƒ©ãƒ•
      ã‚’è¡¨ã«ã—ãŸãƒ‡ãƒ¼ã‚¿ã§ã™

  %div#table-estimate{align: 'center', style: 'margin-top: 50px; scroll-margin-top: 80px;'}
    %b
      %a{href: '#table-estimate'} ğŸ’­
      é–‹å‚¬å›æ•°ã¨å‚åŠ è€…æ•°ã®è¦‹è¾¼ã¿

  %div.table-container{align: 'center'}
    %table.compact{style: 'margin-top: 10px;', border: '1'}
      %tr
        %th
          %span.table-head<> è¥¿æš¦
        - @period_range.each do |year|
          %th
            %b
              %span.table-head &rsquo;#{year.to_s[2..]}
      %tr{style: 'text-align: center;'}
        %td
          %span.table-head<> å‰²åˆ
          %span.table-label<> [%]
        - @annual_dojos_ratio.each_value do |num|
          %td
            %span.table-item= num.eql?('100.0') ? '100' : num
      %tr{style: 'text-align: center;'}
        %td
          %span.table-head<> é–‹å‚¬
          %span.table-label<> (è¦‹è¾¼)
        - @annual_events_table.each_value.with_index(@period_start) do |num, year|
          %td
            %span.table-item= Rational(num, Rational(@annual_dojos_ratio[year.to_s], 100)).to_i
            /%span.table-item== num
            /%span.table-item== Rational(@annual_dojos_ratio[year.to_s], 100)
      %tr{style: 'text-align: center;'}
        %td
          %span.table-head<> å‚åŠ 
          %span.table-label<> (è¦‹è¾¼)
        - @annual_participants_table.each_value.with_index(@period_start) do |num, year|
          %td
            %span.table-item= Rational(num, Rational(@annual_dojos_ratio[year.to_s], 100)).to_i
    %span{style: 'font-size: 10px;'}
      - year = @period_end.to_s
      â€»
      #{year}å¹´ã®å‚åŠ è¦‹è¾¼ã®è¨ˆç®—ä¾‹: #{@annual_participants_table[year]} / 0.#{@annual_dojos_ratio[year].remove('.')} = #{Rational(@annual_participants_table[year], Rational(@annual_dojos_ratio[year], 100)).to_i}
      %small (å°æ•°ç‚¹ä»¥ä¸‹ã¯åˆ‡ã‚Šæ¨ã¦)


  %h2#map{style: "margin-top: 70px; color: #333333;"}
    %a{href: '#map'}<
      ğŸ—¾
    åœ°åŸŸåˆ¥ã®é“å ´æ•°
  .japan-map
    /%p#japan-map-text{style: "margin: 20px auto; font-size: 140%;"} åå‰: é“å ´æ•°
    #japan-map-container
  %div{style: "margin-top: 0px; margin-bottom: 60px;", align: 'center' }
    %p
      %a{href: dojomap_url}
        &raquo; åœ°å›³ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚‹

  / NOTE: Always show dojos with accordion style to compact
  = render partial: 'shared/dojos_stats', locals: { regions_and_dojos: @regions_and_dojos }

  %h2#prefectures{style: "margin-top: 70px; color: #333333;"}
    %a{href: '#prefectures'}<
      âœ…
    éƒ½é“åºœçœŒåˆ¥ã®é“å ´æ•°
  %div{style: "margin-top: 20px;", align: 'center' }
    %table{border: '1'}
      %tr
        %th{style: 'padding: 10px;'}
          %small éƒ½é“åºœçœŒå
        %th{style: 'padding: 10px;'}
          %small é“å ´æ•°
      - @data_by_prefecture.each_with_index do |(prefecture, count), index|
        %tr
          - if count == 0
            %td{style: 'background-color: gainsboro; padding: 0px;'}
              %small= prefecture
            %td{style: 'background-color: gainsboro; padding: 0px;'}
              %small= count
          - else
            %td{style: 'padding: 0px;'}
              %small= prefecture
            %td{style: 'padding: 0px;'}
              %small= count

  %h2#references{style: "margin-top: 70px; color: #333333;"}
    %a{href: '#references'}<
      ğŸ“š
    é–¢é€£ãƒªãƒ³ã‚¯
  %ul
    %li
      %a{href: "https://bit.ly/coderdojo-japan-stats-past-works"} çµ±è¨ˆæƒ…å ±ã«é–¢ã™ã‚‹ã€ã“ã‚Œã¾ã§ã€ã®é–‹ç™º - GitHub
    %li
      %a{href: "https://bit.ly/coderdojo-japan-stats-future-works"} çµ±è¨ˆæƒ…å ±ã«é–¢ã™ã‚‹ã€ã“ã‚Œã‹ã‚‰ã€ã®é–‹ç™º - GitHub
    %li
      %a{href: "https://bit.ly/coderdojo-japan-stats-data-sheet"} æ—¥æœ¬ã® CoderDojo (è²¡å›£&Japan) - Spreadsheet
%br/

:css
  span.table-head  { font-size: x-small }
  span.table-label { font-size: 7px }
  span.table-item  { font-size: xx-small }

:javascript
  $(function(){
    var areas      = JSON.parse('#{@data_by_region.to_json    }'.replace( /&quot;/g, '"'));
    var dataByPref = JSON.parse('#{@data_by_prefecture.to_json}'.replace( /&quot;/g, '"'));

    $("#japan-map-container").japanMap(
      {
        // NOTE: Tweak stats_controller if you want to tweak map colors
        areas: areas,
        selection: "prefecture",
        borderLineWidth: 0.1,
        drawsBoxLine:  false,
        movesIslands:  true,
        showsAreaName: true,
        showsPrefectureName: false,
        prefectureNameType: "short",
        width: 651,
        font : "Hiragino Kaku Gothic Pro",
        fontSize  : 12,
        fontColor : "white",
        fontShadowColor : "#444455",
        onSelect:function(data){
          // This code is used for tapping by Mobile devices
          $("#japan-map-text").html(data.name + ": "+ dataByPref[data.name]);
        },
        onHover:function(data){
          $("#japan-map-text").html(data.name + ": "+ dataByPref[data.name]);
        }
      }
    );
  });


